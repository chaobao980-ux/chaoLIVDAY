<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ¼¢å ¡å¤§è½‰ç›¤æŠ½ç</title>
  <style>
    body {
      background: #e6f7e6;
      font-family: "Microsoft JhengHei", sans-serif;
      text-align: center;
      color: #2e7d32;
    }
    h1 {
      margin-top: 20px;
      color: #1b5e20;
    }
    .container {
      position: relative;
      margin: 20px auto;
      width: 400px;
      height: 400px;
    }
    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 6px 15px rgba(0,0,0,0.25);
    }
    /* æŒ‡é‡ï¼šä¸‰è§’å½¢ + ä¸­å¿ƒåœ“å½¢ */
    #pointer {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-bottom: 50px solid #e53935;
      transform-origin: bottom center;
      transform: translate(-50%, -100%) rotate(0deg);
      transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
      z-index: 10;
    }
    #pointer::after {
      content: "";
      position: absolute;
      bottom: -15px;
      left: -15px;
      width: 30px;
      height: 30px;
      background: #e53935;
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .buttons {
      margin-top: 15px;
    }
    button {
      margin: 10px;
      padding: 12px 30px;
      font-size: 18px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button:hover {
      background: #388e3c;
    }
    .result-area {
      margin-top: 20px;
    }
    #result {
      font-size: 26px;
      font-weight: bold;
      color: #ffffff;
      background: #43a047;
      display: inline-block;
      padding: 10px 25px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    #remaining {
      margin-top: 10px;
      font-size: 18px;
      color: #33691e;
      font-weight: bold;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
      max-width: 600px;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px;
      border: 1px solid #c8e6c9;
      text-align: center;
    }
    th {
      background-color: #81c784;
      color: #fff;
      font-size: 16px;
    }
    td {
      font-size: 15px;
      color: #2e7d32;
    }
    input.qtyInput {
      width: 60px;
      padding: 4px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ğŸ” æ¼¢å ¡å¤§è½‰ç›¤æŠ½ç ğŸŸ</h1>
  <div class="container">
    <canvas id="wheel"></canvas>
    <div id="pointer"></div>
  </div>

  <!-- æŒ‰éˆ• -->
  <div class="buttons">
    <button onclick="spin()">æŠ½ç</button>
    <button onclick="resetPrizes()">é‡è£½çé …</button>
  </div>

  <!-- çµæœ -->
  <div class="result-area">
    <p id="result"></p>
    <p id="remaining"></p>
  </div>

  <table id="prizeTable">
    <thead>
      <tr>
        <th>çå“åç¨±</th>
        <th>å‰©é¤˜æ•¸é‡</th>
        <th>ä¿®æ”¹æ•¸é‡</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const initialPrizes = [
      {name: "æ¼¢å ¡æŠ±æ•", qty: 20},
      {name: "æ¼¢å ¡é‘°åŒ™åœˆ", qty: 80},
      {name: "æ¼¢å ¡é£²æ–™å…Œæ›åˆ¸", qty: 64},
      {name: "35å…ƒé£²æ–™å…Œæ›åˆ¸", qty: 136},
      {name: "å¥—é¤50å…ƒæŠ˜æŠµåˆ¸", qty: 100},
      {name: "è–¯æ¢å…Œæ›åˆ¸", qty: 100},
      {name: "95æŠ˜åˆ¸(QRä¸‹è¼‰å‡ºç¤º)", qty: 500},
      {name: "10å…ƒæŠ˜åƒ¹åˆ¸", qty: 1000}
    ];
    let prizes = JSON.parse(JSON.stringify(initialPrizes));

    let canvas = document.getElementById("wheel");
    let ctx = canvas.getContext("2d");
    let size = 400;
    canvas.width = size;
    canvas.height = size;

    let colors = ["#a5d6a7","#81c784","#66bb6a","#4caf50",
                  "#388e3c","#66bb6a","#81c784","#a5d6a7"];

    let spinning = false;

    function drawWheel() {
      ctx.clearRect(0, 0, size, size);
      let num = prizes.length;
      let arc = 2 * Math.PI / num;
      for (let i = 0; i < num; i++) {
        ctx.beginPath();
        ctx.fillStyle = colors[i % colors.length];
        ctx.moveTo(size/2, size/2);
        ctx.arc(size/2, size/2, size/2-5, i*arc - Math.PI/2, (i+1)*arc - Math.PI/2);
        ctx.fill();

        ctx.save();
        ctx.translate(size/2, size/2);
        ctx.rotate(i*arc + arc/2 - Math.PI/2);
        ctx.textAlign = "center";
        ctx.fillStyle = "#1b5e20";
        ctx.font = "bold 16px Microsoft JhengHei";

        let textRadius = size / 3; // èª¿æ•´æ–‡å­—ä½ç½®åˆ°åœ“ç›¤å…§
        ctx.fillText(prizes[i].name, textRadius, 8);
        ctx.restore();
      }
    }

    function updateTable() {
      let tbody = document.querySelector("#prizeTable tbody");
      tbody.innerHTML = "";
      prizes.forEach((p, i) => {
        let row = `
          <tr>
            <td>${p.name}</td>
            <td>${p.qty}</td>
            <td><input class="qtyInput" type="number" min="0" value="${p.qty}" onchange="changeQty(${i}, this.value)"></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      let total = prizes.reduce((sum, p) => sum + p.qty, 0);
      document.getElementById("remaining").innerText = "å‰©é¤˜çé …ç¸½æ•¸ï¼š" + total;
    }

    function changeQty(index, value) {
      prizes[index].qty = parseInt(value) || 0;
      drawWheel();
      updateTable();
    }

    function resetPrizes() {
      prizes = JSON.parse(JSON.stringify(initialPrizes));
      drawWheel();
      updateTable();
      document.getElementById("result").innerText = "âœ… å·²é‡è£½çé …æ•¸é‡";
    }

    function spin() {
      if (spinning) return;
      let available = prizes.filter(p => p.qty > 0);
      if (available.length === 0) {
        document.getElementById("result").innerText = "ğŸ‰ æ‰€æœ‰çå“æŠ½å®Œï¼";
        return;
      }

      let totalQty = available.reduce((sum, p) => sum + p.qty, 0);
      let rand = Math.floor(Math.random() * totalQty);
      let cumulative = 0;
      let selectedIndex;
      for (let i = 0; i < available.length; i++) {
        cumulative += available[i].qty;
        if (rand < cumulative) {
          selectedIndex = prizes.indexOf(available[i]);
          break;
        }
      }

      let num = prizes.length;
      let arc = 360 / num;
      let extraSpins = Math.floor(Math.random() * 6) + 3;
      let stopAngle = (selectedIndex * arc + arc/2) + (360 * extraSpins);

      spinning = true;
      let pointer = document.getElementById("pointer");
      pointer.style.transition = "none";
      pointer.style.transform = "translate(-50%, -100%) rotate(0deg)";
      void pointer.offsetWidth;

      pointer.style.transition = "transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)";
      pointer.style.transform = `translate(-50%, -100%) rotate(${stopAngle}deg)`;

      setTimeout(() => {
        prizes[selectedIndex].qty--;
        document.getElementById("result").innerHTML = `ğŸ‰ æ­å–œæŠ½ä¸­ <b>${prizes[selectedIndex].name}</b>ï¼`;
        spinning = false;
        drawWheel();
        updateTable();
      }, 5200);
    }

    drawWheel();
    updateTable();
  </script>
</body>
</html>
